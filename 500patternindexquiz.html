<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>500 Pattern Test (Korean Pattern Quiz)</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#12141a;
      --text:#f4f6ff;
      --muted:#aab1c3;
      --line:rgba(255,255,255,.08);

      --accent:#ffd6e7;     /* 시작 버튼 연한 분홍 */
      --accentText:#251018;

      --sel:#5af0c8;        /* 선택 강조 */
      --selText:#062018;

      --danger:#ff3b30;     /* iOS red */

      --radius:18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --shadow2: 0 6px 14px rgba(0,0,0,.35);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display","SF Pro Text", system-ui, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, #12162a 0%, var(--bg) 55%, #06070a 100%);
      color:var(--text);
      min-height:100vh;
      padding: 14px 12px 18px;
    }
    .app{ max-width: 980px; margin: 0 auto; }
    header{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; margin-bottom: 12px;
    }
    .title{ display:flex; flex-direction:column; gap:4px; }
    .title h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    .title .sub{ font-size:12px; color:var(--muted); }
    .pill{
      padding: 8px 10px; border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 999px; color: var(--muted);
      font-size: 12px; white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .75fr;
      gap: 12px;
      align-items:start;
    }
    @media (max-width: 860px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 12px 12px 10px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .card .hd h2{
      margin:0; font-size:14px; color:#eaf0ff; letter-spacing:.2px;
    }
    .card .bd{ padding: 12px; }

    /* Buttons */
    .btn{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      font-size: 14px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, filter .15s ease, background .15s ease, border-color .15s ease;
      position:relative;
      overflow:hidden;
      box-shadow: 0 1px 0 rgba(255,255,255,.08) inset, 0 10px 24px rgba(0,0,0,.25);
    }
    .btn:active{ transform: translateY(1px) scale(.99); filter: brightness(.98); }
    .btn[disabled]{ opacity:.45; cursor:not-allowed; transform:none; box-shadow:none; }

    /* Premium press glow */
    .btn::after{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle at var(--px, 50%) var(--py, 40%), rgba(255,255,255,.24) 0%, rgba(255,255,255,0) 55%);
      opacity:0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .btn.pressed::after{ opacity:1; }

    .btn-primary{
      background: linear-gradient(180deg, rgba(255,214,231,.95), rgba(255,214,231,.68));
      border-color: rgba(255,214,231,.55);
      color: var(--accentText);
      box-shadow: 0 1px 0 rgba(255,255,255,.55) inset, 0 14px 30px rgba(255,214,231,.10);
      font-weight: 800;
    }
    .btn-danger{
      background: linear-gradient(180deg, rgba(255,59,48,.92), rgba(255,59,48,.60));
      border-color: rgba(255,59,48,.55);
      color: white;
      font-weight: 900;
    }
    .btn-ghost{
      background: rgba(255,255,255,.03);
      border-color: var(--line);
      color: var(--text);
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 10px 24px rgba(0,0,0,.22);
    }
    .btn-small{ padding: 9px 10px; border-radius: 13px; font-size: 13px; }
    .btn-tall{
      padding-top: 18px; padding-bottom: 18px;
      border-radius: 16px; min-height: 62px;
      font-size: 16px;
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row.tight{ gap:8px; }
    .row.split{ display:flex; gap:10px; flex-wrap:wrap; }
    .row.split > *{ flex:1; min-width: 160px; }

    /* Day buttons grid */
    .dayGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
      gap: 8px;
    }
    .chip{
      padding: 10px 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-size: 13px;
      cursor:pointer;
      text-align:center;
      user-select:none;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset;
    }
    .chip:active{ transform: translateY(1px) scale(.99); }
    .chip.selected{
      background: linear-gradient(180deg, rgba(90,240,200,.96), rgba(90,240,200,.62));
      border-color: rgba(90,240,200,.62);
      color: var(--selText);
      font-weight: 900;
      box-shadow: 0 1px 0 rgba(255,255,255,.55) inset, 0 12px 24px rgba(90,240,200,.08);
    }
    .chip .mini{
      display:block; font-size: 11px; opacity:.75; margin-top: 2px; font-weight: 700;
    }

    /* Count chips */
    .countGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(72px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    /* Inputs */
    label{ display:block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    input, textarea, select{
      width: 100%;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 15px;
      outline:none;
      transition: border-color .15s ease, background .15s ease;
    }
    textarea{ min-height: 60px; resize: vertical; }
    input:focus, textarea:focus{
      border-color: rgba(255,214,231,.55);
      background: rgba(0,0,0,.28);
    }
    .hint{ color: var(--muted); font-size: 12px; line-height: 1.35; margin-top: 8px; }

    /* Screens */
    .screen{ display:none; }
    .screen.active{ display:block; }

    /* Quiz */
    .qTop{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap; margin-bottom: 10px;
    }
    .progress{ font-size: 12px; color: var(--muted); }
    .question{
      font-size: 22px; line-height: 1.25;
      padding: 14px 14px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      border:1px solid var(--line);
      box-shadow: var(--shadow2);
      margin: 10px 0 12px;
      word-break: keep-all;
    }

    .answerBox{
      display:none;
      margin-top: 10px;
      padding: 12px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .answerBox.show{ display:block; }

    .aTitle{
      font-weight: 900; font-size: 13px; letter-spacing:.2px;
      color: #f2f5ff; margin-bottom: 8px;
    }
    .exList{ display:flex; flex-direction:column; gap:10px; }
    .exItem{
      padding: 10px 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
    }
    .exKo{
      font-size: 14px; color: #f6f7ff;
      font-weight: 800; margin-bottom: 5px;
      word-break: keep-all;
    }
    .exEn{ font-size: 13px; color: var(--muted); word-break: break-word; }
    .exActions{
      display:flex; justify-content:flex-end;
      gap:8px; margin-top: 8px; flex-wrap:wrap;
    }

    .addExample{
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed rgba(255,255,255,.12);
    }

    /* Results */
    .resultSummary{
      padding: 12px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      margin-bottom: 12px;
    }
    .resultSummary .big{ font-size: 16px; font-weight: 900; margin-bottom: 6px; }
    .resultSummary .small{ font-size: 12px; color: var(--muted); line-height: 1.4; }

    .wrongCard{
      padding: 12px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      margin-bottom: 10px;
    }
    .wrongCard .wk{
      font-weight: 900;
      font-size: 15px;
      margin-bottom: 8px;
      word-break: keep-all;
    }
    .wrongCard .dayTag{
      display:inline-block;
      margin-left: 8px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      color: var(--muted);
      background: rgba(0,0,0,.18);
      vertical-align: middle;
    }

    .statusLine{ margin-top: 10px; font-size: 12px; color: var(--muted); min-height: 16px; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size: 12px;
      color:#cbd3e5;
      white-space:pre-wrap;
      line-height: 1.4;
    }
    .tag{
      display:inline-block;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      color: var(--muted);
      background: rgba(0,0,0,.18);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 28px;
      height: 28px;
      padding: 0 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 900;
      font-size: 12px;
      line-height: 1;
    }
    .badge.on{
      background: linear-gradient(180deg, rgba(90,240,200,.92), rgba(90,240,200,.60));
      border-color: rgba(90,240,200,.60);
      color: var(--selText);
      box-shadow: 0 1px 0 rgba(255,255,255,.55) inset, 0 12px 24px rgba(90,240,200,.06);
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="title">
      <h1>패턴 말하기 퀴즈 (한글 → 예문 확인)</h1>
      <div class="sub">DAY 1~20(기본) + DAY21~(내가 추가한 패턴/예문) · 저장: 기기(localStorage)</div>
    </div>
    <div class="pill" id="todayPill"></div>
  </header>

  <!-- HOME -->
  <section id="screenHome" class="screen active">
    <div class="grid">
      <div class="card">
        <div class="hd">
          <h2>DAY 선택 (복수 선택)</h2>
          <button class="btn btn-small btn-ghost" id="btnSelectAll">전체 선택</button>
        </div>
        <div class="bd">
          <div class="dayGrid" id="dayGrid"></div>

          <div style="height:12px"></div>

          <h2 style="margin:0 0 6px; font-size:14px; color:#eaf0ff;">퀴즈 개수 선택</h2>
          <div class="countGrid" id="countGrid"></div>

          <div style="height:12px"></div>

          <button class="btn btn-primary btn-tall" id="btnStart">퀴즈 시작</button>
          <div class="statusLine" id="homeStatus"></div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <h2>새 패턴 추가 (DAY21부터)</h2>
          <button class="btn btn-small btn-ghost" id="btnGoManage">데이터 관리</button>
        </div>
        <div class="bd">
          <label>DAY 번호 (21부터) — 비워두면 자동 배정(25개 차면 다음 DAY로)</label>
          <input id="inpNewDay" type="number" min="21" placeholder="예: 21 (비워두면 자동)" />

          <div style="height:10px"></div>

          <label>패턴 한글 의미</label>
          <textarea id="inpNewPattern" placeholder="예: ~인 것 같아"></textarea>

          <div style="height:10px"></div>

          <button class="btn btn-small btn-ghost" id="btnAddPattern">패턴 추가</button>
          <div class="hint">
            · 새 패턴은 DAY21부터 저장돼요. <br/>
            · DAY21에 25개가 차 있으면 자동으로 DAY22로 넘어가요.
          </div>
          <div class="statusLine" id="addPatternStatus"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="screenQuiz" class="screen">
    <div class="card">
      <div class="hd">
        <h2>퀴즈</h2>
        <div class="row tight">
          <span class="badge" id="reviewBadge" title="오늘 복습(체크한 예문) 개수">0</span>
          <button class="btn btn-small btn-ghost" id="btnBackHome">처음으로</button>
        </div>
      </div>
      <div class="bd">
        <div class="qTop">
          <div class="progress" id="progressText"></div>
          <div class="progress" id="dayInfo"></div>
        </div>

        <div class="question" id="questionText"></div>

        <div class="row">
          <button class="btn btn-ghost btn-tall" id="btnShowAnswer">정답 확인</button>
        </div>

        <div class="answerBox" id="answerBox">
          <div class="aTitle">정답(예문) — 한글 → 영어 <span class="tag">각 예문 오른쪽 L 버튼으로 “복습(오늘)”에 추가</span></div>
          <div class="exList" id="exampleList"></div>

          <div class="addExample" id="addExampleArea">
            <div class="aTitle">예문 추가 (한글/영어) · 개별 삭제 가능</div>
            <label>예문(한글)</label>
            <textarea id="inpExKo" placeholder="예: (한글 예문)"></textarea>
            <div style="height:10px"></div>
            <label>예문(영어)</label>
            <textarea id="inpExEn" placeholder="예: (영어 예문)"></textarea>

            <div style="height:10px"></div>
            <div class="row split">
              <button class="btn btn-small btn-ghost" id="btnAddExample">예문 추가</button>
              <button class="btn btn-danger btn-small" id="btnDeleteAllExamples">모든 예문 삭제</button>
            </div>
            <div class="statusLine" id="exStatus"></div>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="btn btn-primary btn-tall" id="btnNext">NEXT</button>
        </div>

        <div class="statusLine" id="quizStatus"></div>
      </div>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="screenResult" class="screen">
    <div class="card">
      <div class="hd">
        <h2>결과</h2>
        <div class="row tight">
          <button class="btn btn-small btn-ghost" id="btnRestart">다시 시작</button>
          <button class="btn btn-small btn-primary" id="btnCopyWrong">오늘 복습 문장 복사</button>
          <button class="btn btn-small btn-danger" id="btnClearReview">복습 초기화</button>
        </div>
      </div>
      <div class="bd">
        <div class="resultSummary">
          <div class="big" id="resultBig"></div>
          <div class="small" id="resultSmall"></div>
          <div class="statusLine" id="copyStatus"></div>
        </div>

        <div id="wrongListWrap"></div>
      </div>
    </div>
  </section>

  <!-- MANAGE -->
  <section id="screenManage" class="screen">
    <div class="card">
      <div class="hd">
        <h2>데이터 관리</h2>
        <div class="row tight">
          <button class="btn btn-small btn-ghost" id="btnManageBack">처음으로</button>
        </div>
      </div>
      <div class="bd">
        <div class="row">
          <button class="btn btn-small btn-ghost" id="btnGoImport">DAY 예문 가져오기</button>
          <span class="tag">DAY2~20 예문 4개씩 붙여넣기용</span>
        </div>
        <div style="height:10px"></div>
        <div class="hint">
          여기서는 전체 데이터 확인만 가능. (예문 삭제/추가는 퀴즈에서 해당 패턴 들어가서 관리)
        </div>
        <div style="height:10px"></div>
        <div id="manageDump" class="mono"></div>
      </div>
    </div>
  </section>

  <!-- IMPORT -->
  <section id="screenImport" class="screen">
    <div class="card">
      <div class="hd">
        <h2>DAY 예문 가져오기 (패턴 1개 = 예문 4개)</h2>
        <div class="row tight">
          <button class="btn btn-small btn-ghost" id="btnImportBack">데이터 관리로</button>
        </div>
      </div>
      <div class="bd">
        <div class="row split">
          <div>
            <label>적용할 DAY</label>
            <select id="selImportDay"></select>
            <div class="hint">DAY2~DAY20만 여기에 넣는 걸 추천해. (DAY1은 이미 완성)</div>
          </div>
          <div>
            <label>옵션</label>
            <div class="row">
              <button class="btn btn-small btn-danger" id="btnImportClearDay">이 DAY 예문 전체 삭제</button>
            </div>
            <div class="hint">※ 패턴은 유지, 예문만 싹 지워져.</div>
          </div>
        </div>

        <div style="height:12px"></div>

        <label>붙여넣기 (권장 포맷: 패턴 1줄 + 예문 8줄(한글/영어 4쌍) 반복)</label>
        <textarea id="txtImport" style="min-height:220px;" placeholder="예)
~가 없어
한글예문1
영어예문1
한글예문2
영어예문2
한글예문3
영어예문3
한글예문4
영어예문4

~한건 아무것도 없어
...
"></textarea>

        <div style="height:10px"></div>

        <div class="row split">
          <button class="btn btn-small btn-ghost" id="btnImportPreview">미리보기</button>
          <button class="btn btn-small btn-primary" id="btnImportApply">적용(저장)</button>
        </div>

        <div class="statusLine" id="importStatus"></div>

        <div style="height:12px"></div>

        <div class="card" style="box-shadow:none;">
          <div class="hd">
            <h2>미리보기 결과</h2>
          </div>
          <div class="bd">
            <div id="importPreview" class="mono">(미리보기 버튼을 누르면 여기에 보여)</div>
          </div>
        </div>
      </div>
    </div>
  </section>

</div>

<script>
/* =========================
   Utilities
========================= */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));

function todayKey(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function uid(prefix="id"){
  return prefix + "_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
}
function safeTrim(s){ return (s ?? "").toString().trim(); }
function escapeHtml(str){
  return (str ?? "").toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* Premium press glow on buttons */
function attachPressGlow(el){
  el.addEventListener("pointerdown", (e)=>{
    if(el.disabled) return;
    const r = el.getBoundingClientRect();
    const px = ((e.clientX - r.left) / r.width) * 100;
    const py = ((e.clientY - r.top) / r.height) * 100;
    el.style.setProperty("--px", px.toFixed(1)+"%");
    el.style.setProperty("--py", py.toFixed(1)+"%");
    el.classList.add("pressed");
  });
  const off = ()=> el.classList.remove("pressed");
  el.addEventListener("pointerup", off);
  el.addEventListener("pointercancel", off);
  el.addEventListener("pointerleave", off);
}

/* Clipboard copy (no alert/popup) */
async function copyText(text){
  try{
    await navigator.clipboard.writeText(text);
    return true;
  }catch(e){
    const ta = document.createElement("textarea");
    ta.value = text;
    ta.style.position="fixed";
    ta.style.left="-9999px";
    ta.style.top="0";
    document.body.appendChild(ta);
    ta.focus(); ta.select();
    try{
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }catch(err){
      document.body.removeChild(ta);
      return false;
    }
  }
}

/* =========================
   Storage Keys (현재 키)
   + 레거시 키 자동 탐색/마이그레이션
========================= */
const STORE_KEY = "patternQuizApp.days";     // ✅ 앞으로 이 키로 고정 (키 바뀌면 데이터 사라지는 문제 방지)
const STORE_UI  = "patternQuizApp.ui";
function REVIEW_KEY(){ return "patternQuizApp.review." + todayKey(); }

/* =========================
   Base Data (DAY1~DAY20)
   - DAY1: 공식 예문 4개씩 포함
   - DAY2~20: 패턴만(예문 비움)
========================= */

/* DAY1 패턴 25개 */
const day1Patterns = [
  "~인 것 같아","~는 아닌 것 같아","~를 생각중이야","~를 생각하고 있었어","~를 계속 생각해왔어",
  "~라고 생각해?","~인 것 같지 않아?","~에 대해 어떻게 생각해?","~에 대해 어떻게 생각해?","~는 어때?",
  "~를 알아","전부터 ~를 알고 있었어","~인지 아닌지 모르겠어","뭘~할지 모르겠어","~에 대해서는 전혀 몰라",
  "~를 아니?","~가 뭔지 아니?","왜~하는지 아니?","언제~하는지 아니?","~인지 아닌지 아니?",
  "~가 있어","~가 별로 없어","~가 있었어","~가 있을 거야","분명~가 있을 거야"
];
const day1En = [
  "I think I saw him before.","I think the movie's almost over.","I think it's going to rain soon.","I think we should get going.",
  "I don't think he's very kind.","I don't think we can wait that long.","I don't think I can attend the meeting.","I don't think that's necessary.",
  "I'm thinking about buying a laptop.","I'm thinking about going out tonight.","I'm thinking about getting plastic surgery.","I'm thinking about what you said.",
  "I was thinking about calling you.","I was thinking about you","I was thinking about going to the mall.","I was thinking about getting a motorcycle.",
  "I've been thinking about starting a business.","I've been thinking about getting a divorce.","I've been thinking about selling the old car.","I've been thinking about quitting my job.",
  "Do you think she's pretty?","Do you think he's lying?","Do you think we'll win?","Do you think there's enough time?",
  "Don't you think it's too cold today?","Don't you think that's amazing?","Don't you think it's a little too soon?","Don't you think she's too young for him?",
  "What do you think of my new shoes?","What do you think of Gina's boyfriend?","What do you think of our instructor?","What do you think of gay marriage?",
  "What do you think about this painting?","What do you think about her?","What do you think about her new hairstyle?","What do you think about leaving early?",
  "How do you like the music?","How do you like it?","How do you like the wine?","How do you like your eggs?",
  "I know what you did.","I know this area very well.","I know how to make Tom laugh.","I know how you feel.",
  "I've known her for 10 years.","I've known Phil for a long time.","I've known him since he was a kid.","I've known about this for a week.",
  "I don't know if I can do this.","I don't know if she told you.","I don't know if we can come.","I don't know if he'll like it.",
  "I don't know what to choose.","I don't know where to start?","I don't know how to solve this problem.","I don't know which way to go.",
  "I don't know anything about you.","I don't know anything about it.","I don't know anything about Carla's love life.","I don't know anything about politics.",
  "Do you know my cell phone number?","Do you know each other?","Do you know he's engaged?","Do you know anything about him?",
  "Do you know what happened?","Do you know what his name is?","Do you know what this means?","Do you know what Lydia said?",
  "Do you know why it's cold in here?","Do you know why she didn't come?","Do you know why he's angry?","Do you know why she left the company?",
  "Do you know when his birthday is?","Do you know when he arrived?","Do you know when this will be over?","Do you know when the fireworks start?",
  "Do you know if Jim has any allergies?","Do you know if we're getting raises?","Do you know if Jane's coming?","Do you know if the show starts at 7:00?",
  "There's a possibility.","There's a problem.","There's a traffic jam.","There's a strong wind.",
  "There are only a few tickets left.","There are a few cars parked.","There are so many things to do today.","There are too many problems with this.",
  "There has been an accident.","There has been some change.","There has been little time to prepare.","There has been a misunderstanding.",
  "There will be a test this Friday.","There will be many people at the party.","There will be many prizes at the event.","There will be no next time.",
  "There must be a better way.","There must be more beer.","There must be a lot of people there.","There must be someone in charge."
];
const day1Ko = [
  "전에 저 사람을 본 것 같은데.","영화가 거의 다 끝난 것 같아.","금방 비가 올 것 같아.","우린 가봐야 할 것 같은데.",
  "그 사람 썩 친절하지는 않은 것 같아.","우린 그렇게 오래 못 기다릴 것 같은데.","나 그 회의에 참석 못할 것 같아.","그건 필요 없을 것 같아.",
  "노트북을 하나 살까 생각 중이야.","오늘 밤에 외출할까 생각 중이야.","성형수술을 할까 생각 중이야.","네가 한 말에 대해 생각하고 있어.",
  "너한테 전화할까 생 중이었는데.","네 생각 하고 있었어.","쇼핑몰에 갈까 생각하던 중이었어.","오토바이를 장만해볼까 생각하고 있었어.",
  "사업을 해볼까 하고 계속 생각해왔어.","이혼에 대해 계속 생각해왔어.","낡은 차를 팔아버릴까 계속 생각하고 있었어.","회사를 그만둘까 계속 생각해왔어.",
  "그 여자가 예쁜 것 같아?","그 애가 거짓말하고 있다고 생각해?","우리가 이길 것 같니?","시간이 충분하다고 생각해?",
  "오늘 너무 추운 것 같지 않아?","그거 대단한 것 같지 않니?","좀 너무 빠른 것 같지 않아?","그 여자는 그에게 너무 어린 것 같지 않니?",
  "내가 새로 산 신발 어때?","지나의 남자친구는 어떤 것 같니?","우리 선생님에 대해 어떻게 생각해?","동성 결혼에 대해 어떻게 생각하니?",
  "이 그림 어떤 것 같니?","그 여자에 대해 어떻게 생각해?","그여자 새로 한 머리 스타일 어때?","일찍 떠나는 것에 대해서 어떻게 생각하니?",
  "그 음악 어때? (마음에 드니?)","그거 마음에 드니?","그 와인은 어떤 것 같아? (괜찮아?)","계란을 어떻게 요리해줄까?",
  "네가 무슨 짓을 했는지 다 알아.","내가 이 지역은 꽉 잡고 있지.","어떻게 해야 톰을 웃길 수 있는지 알아.","네 기분이 어떤지 알아.",
  "난 10년 전부터 그 여자를 알고 있었어.","나는 오랫동안 필을 알고 지냈어.","난 그 사람을 어렸을 때부터 알아왔어.","난 일주일 전부터 이것을 알고 있었어.",
  "내가 이걸 할 수 있을지 모르겠어.","그 애가 너에게 이야기했는지 모르겠구나.","우리가 갈 수 있을지 모르겠어.","그 사람이 그걸 좋아할지 모르겠다.",
  "뭘 골라야 할지 모르겠어.","어디에서 시작해야 할지 모르겠어.","이 문제를 어떻게 푸는지 모르겠어.","어느 길로 가야 할지 모르겠어.",
  "난 너에 대해 아는 게 하나도 없어.","그것에 대해서는 전혀 몰라 .","칼라의 연애생활에 대해서는 아무것도 몰라","정치에 대해서는 전혀 몰라요.",
  "내 휴대폰 번호 알아?","서로 아는 사이야?","그 남자 약혼한 거 알고 있어?","그 사람에 대해 아는 게 좀 있니?",
  "무슨 일이 일어났는지 아니?","그 애 이름이 뭔지 알아?","이게 무슨 뜻인지 알아?","리디아가 뭐라고 했는지 알아?",
  "왜 여기가 추운지 알아?","그 애가 왜 안왔는지 아니?","그 남자애개 화가 난 이유를 알고 있어?","그 애가 왜 회사를 그만뒀는지 알아?",
  "그 애 생일이 언제인지 알아?","그분이 언제 도착했는지 알아요?","이게 언제 끝날지 알아요?","언제 불꽃놀이가 시작되는지 알아?",
  "혹시 짐이 알레르기가 있니?","우리 월급이 인상될지 알고 있니?","제인이 올지 안 올지 아니?","혹시 그 프로가 7시에 시작하니?",
  "가능성이 있어.","문제가 생겼어.","차가 막혀.","바람이 세게 불어.",
  "남은 표가 별로 없어.","자동차 몇 대가 주차되어 있어.","오늘 할 일이 무척 많거든.","이건 문제가 너무 많아.",
  "사고가 났어.","바뀐 게 좀 있어.","준비할 시간이 별로 없었어.","오해가 있었어요.",
  "이번 주 금요일에 시험이 있을 거예요.","파티에 사람들이 많이 올 거야.","행사에 경품이 많을 거야.","이번만 봐주는 거야.",
  "분명 더 나은 방법이 있을 거야.","맥주가 분명히 더 있을 텐데.","거기에 사람들이 분명 많이 올거야.","담당자가 분명히 있을 거야."
];

function buildDay1WithOfficialExamples(){
  const patterns = [];
  for(let i=0;i<day1Patterns.length;i++){
    const pid = `D1P${i+1}`;
    const examples = [];
    const baseIndex = i*4;
    for(let k=0;k<4;k++){
      examples.push({
        id: uid("ex"),
        en: day1En[baseIndex+k] ?? "",
        ko: day1Ko[baseIndex+k] ?? "",
        source:"official"
      });
    }
    patterns.push({ id: pid, ko: day1Patterns[i], examples });
  }
  return { day: 1, patterns };
}

/* DAY2~DAY4 */
const day2Patterns = [
  "~가 없어","~한건 아무것도 없어","~하는 사람은 아무도 없어","~할 시간이 없어","~할 필요 없어",
  "~가 있어?","~가 좀 있어?","~한 게 있나요?","~하는 사람 있어?","~가 많나요?",
  "~할 방법이 없을까요?","~하는 건 불가능해","내가 ~하는 건 불가능해","더 ~하는 방법이 있어","~하려면 어떤 방법이 좋을까요?",
  "~하고 싶어","난 단지 ~하고 싶었어","~하고 싶지 않아","~하고 싶어요","난 정말 ~하고 싶어요",
  "~할래?","~하지 않을래?","뭘~하고 싶어?","왜~하고 싶어?","언제~하고 싶어?"
];
const day3Patterns = [
  "~는 어때?","~는 어때?","~하자","~하지 말자","~하는 게 좋겠어",
  "~하지 그래?","우리 ~하는 게 어때요?","우리 ~해야 할지도 모르겠어","우리 ~하자","제가~를 제안해도 될까요?",
  "난 좀 ~해","난 정말 ~해","난 완전히~해","그건 좀 ~해","이건 완전히 ~야",
  "~에 만족해","~해서 정말 기뻐","~해서 기쁘다","기꺼이 ~할게","~할 용의가 있어",
  "~해서 놀랐어","~를 믿을 수가 없어","넌 ~를 못 믿을 거야","~하다니 충격적이었어","~하는 건 당연해"
];
const day4Patterns = [
  "난 ~가 무서워","난~가 걱정돼","~ 때문에 긴장돼","~하다니 실망이야","~해서 참 답답해",
  "~를 좋아하니?","나 ~를 좋아해","난~에 빠졌어","난 ~를 좋아하지 않아","난~하는 방식이 맘에 안들어",
  "~할 때가 좋아","~하면 정말 싫어","~에관심있어요?","~에 관심없어요","~는 신경안써",
  "네 ~가 멋진데","네가 ~하는 방식이 좋아","넌 참~하구나","넌~를 잘하는구나","넌 감각이 뛰어나구나",
  "~해서 고마워","~에 감사드려요","~해주신다면정말감사하겠어요","~해주시니 정말","~하다니 정말 고마워"
];

/* DAY5~DAY20 (패턴만) */
const day5Patterns = [
  "~하려고 해","~하지 않을거야","~할거니?","~안 할거니?","내가 ~할게",
  "~할 준비가 됐어?","~할 준비가 됐어","~하려던 참이었어","~하려던 참이었어","~할 계획이야",
  "~해야해","~해야해","~해야해","~해야겠어","~하는게 좋겠어",
  "~해야 하니?","왜 ~해야 돼?","나 ~해야 해?","왜 내가 ~해야 돼?","난 ~할 필요가 없어",
  "어디에서 ~하니?","어디서~했어?","어디서~할 수 있나요?","가장 가까운 ~가 어디죠?","~하기에 가장 좋은곳이 어디죠?"
];
const day6Patterns = [
  "누가~니?","네~가 누구야?","누가 ~할거니?","~할 사람?","그거 누구의 ~야?",
  "너의 ~는 뭐야?","뭘~할거야?","~는 어때?","어떤 종류의 ~를 ...해?","~가 어떻게 된 거야?",
  "언제~했니?","언제~할 거니?","언제~할 거니?","언제~하는게 가장 좋아?","마지막으로~한게 언제였지?",
  "내가 ~할게","~를 알려줘","~에대해 생각해볼게","~인지 볼게","~를 확인해볼게",
  "그래서~인거야","~하니까 그렇지","그게 바로 ~야","~한건 그게 아니야","그렇게 ~하는 거야"
];
const day7Patterns = [
  "거기서 ~한거야","그때 ~한거야","~한 게 그거야?","그것 때문에~인가요?","~밖에 없어?",
  "난 ~만 있으면 돼","내가 아는 건~뿐이야","넌 ~만 하면돼","내가 ...할수 있는 건 ~밖에 없어","내가 ~한 건 그게 다야",
  "~해서 미안해","~해서 미안해","~해서 미안해","만약 ~했다면 정말 미안해","~에대해 사과드려요",
  "~하려던 거였어","...하려던 건 아니었어","..하려던 건 절대 아니었어","그렇다고 ..인건 아니야","내 말은 ..라는 거야",
  "...하려고했어","..할 수밖에 없었어","..할 수밖에 없었어","..에 대해선 변명의 여기가 없어","내가 왜 ..했는지 모르겠어"
];
const day8Patterns = [
  "..가 안됐어요","..하다니 아깝다","..하다니 너무 안됐어","..하다니 안타깝네요","유감스럽지만..입니다",
  "분명히...야","..인지 잘 모르겠어","...라고 확신해","...가 미심쩍어","...가 의심스러워",
  "..가 확실해?","..라는 게 사실이야?","...라는 말이니?","...라는 말이야?","설마 ...는 아니겠지",
  "왜...인지궁금해","...가 뭔지 궁금해","..인지궁금해","...가 궁금해","혹시..할까해서요",
  "왜 그렇게...해?","왜...하고있니?","왜...했어?","어째서..인거야?","왜...하니?"
];
const day9Patterns = [
  "...해도 될까요?","..해도 될까요?","...해도 괜찮나요?","..해도 괜찮을까요?","...하시면 안돼요",
  "..해주시겠어요?","...를 좀 알려줄래?","...를 좀 줄래?","...좀 갖다 줄래?","~좀 해주시겠어요?",
  "...하는 걸 도와줘","...하는 것 좀 도와줄래요?","...를 도와줄게","..를 도와줄까요?","그건 ...하는데 도움돼",
  "...줄까?","...드릴까요?","...좀 갖다 드릴까요?","...해 드릴까요?","...가 필요하니?",
  "..하는 거 잊지마","꼭 ...해라","꼭...해라","마음껏 ... 해라","주저하지 말고 ...해"
];
const day10Patterns = [
  "...하는게 좋겠어","...하면 안돼","...하는게 좋을거야","너...해야해.","너 ...할 필요없어",
  "넌 ...해야돼","넌...해야할거야","넌...하지 않아도돼","넌 꼭 ...해야돼","넌 절대로 ...하면 안돼",
  "그렇게...하지 좀 마","...를 후회하게 될거야","내가 ...하라고 했잖아","내가 ...하지 말라고 했잖아","...라고 경고했어",
  "기분이...해","... 같은 기분이야","..하면 ...해져","너 ..해 보인다","그건 ..인 건 같아",
  "(보기에)...인것같아","(듣고 보니).. 인 것 같아","...같은 냄새가 나는데","...같은 맛이야","(느낌상)...인것같아"
];
const day10En = [
  "You should get your hair cut.","You should learn how to cook.","You should try to eat more vegetables.","You should act your age.","You shouldn't act like that.",
  "You shouldn't skip meals.","You shouldn't quit so easily.","You shouldn't bite your fingernails.","You'd better go see a doctor.","You'd better get some sleep.",
  "You'd better get a lawyer.","You'd better stay away from him.","You need to get over her.","You need to get cleaned up.","You need to do this right away.",
  "You need to settle down.","You don't need to tell the whole story.","You don't need to be there early.","You don't need to know the details of this project.","You don't need to feel bad about this.",

  "You have to keep it a secret.","You have to try harder.","You have to cut down on your drinking.","You have to get a driver's license.","You will have to be back by 10.",
  "You will have to wait a while for that.","You will have to pay for that.","You will have to do better than this next time.",
  "You don't have to pay for it.","You don't have to thank me.","You don't have to do it right away.","You don't have to pay attention to that.",

  "You must make the choice.","You must meet the deadline!","You must come and see this.","You must hear this rock band.",
  "You must not give up.","You must not get drunk.","You must not eat too much.","You must not get excited.",

  "Don't be so sure.","Don't be so impatient.","Don't be so stubborn.","Don't be so sarcastic.",
  "You'll regret that tattoo.","You'll regret letting her go.","You'll regret if you don't at least try.","You'll regret if you don't get the house now.",

  "I told you to stop telling me lies.","I told you to wait for me.","I told you to stop bugging me.","I told you to cut down on sugar.",
  "I told you not to interrupt me.","I told you not to drink and drive.","I told you not to hang up on me.","I told you not to eat that.",

  "I warned you to stay away from me.","I warned him that I would call the police.","I warned the children about the poison.","I warned you not to do it.",

  "I feel so tired today.","I feel awful.","I feel so small.","I feel so guilty.",
  "I feel like the project's going well.","I feel like she hates me.","I feel like I can't win.","I feel like an idiot.",

  "Rainy days make me feel gloomy.","This sofa makes me feel comfortable.","He always makes me feel better.","You make me feel like your slave.",

  "You look familiar.","You look fabulous today.","You look a little down.","You look ten years younger!",

  "It's like looking for a needle in a haystack.","It's like a bad dream.","It's like I'm on trial here.","It's like the best relationship I've had.",

  "Looks like she is busy.","Looks like your dog is sick.","Looks like you need a new car.","Looks like she is busy.",

  "Sounds like a good idea.","Sounds like Jerry likes you.","Sounds like you made him angry.","Sounds like you've got a bad cold.",

  "Smells like something's burning in the house.","Smells like something's rotting.","Smells like diesel fuel.","Smells like cabbage in here.",

  "Tastes like chicken.","Tastes like mom's recipe.","Tastes like it's spoiled.","Tastes like you used too much salt.",

  "It feels like something will happen.","It feels like it's going to rain.","It feels like I'm all alone.","It feels like an argument."
];
const day10Ko = [
  "머리를 자르는 게 좋겠어.","너 요리하는 법을 좀 배워야겠다.","채소를 더 많이 먹도록 해야 해요.","나이에 맞게 행동해야지.","그런 식으로 행동하면 안 되지.",
  "식사를 거르면 안 돼.","그렇게 쉽게 그만두면 안 돼.","손톱을 물어뜯으면 안 돼요.","병원에 가보는 게 좋겠는데.","잠을 좀 자두는 게 좋을 거야.",
  "변호사를 고용하는 게 좋겠어.","그 사람에게서 떨어지는 게 좋을걸.","그 여자를 잊어야 해.","너 좀 씻어야겠다.","너 이거 지금 당장 해야 해.",
  "너도 결혼해서 자리잡아야지.","모든 이야기를 다 할 필요는 없어.","거기 일찍 갈 필요 없어.","네가 이 프로젝트의 세부사항을 알 필요는 없어.","이것 때문에 마음 상할 거 없어.",

  "그걸 비밀로 해야 돼.","넌 더 노력해야 돼.","넌 술을 줄여야 돼.","넌 운전면허를 따야 해.","10시까지는 돌아와야 할 거야.",
  "그건 좀 기다려야 할 거야.","그것에 대해 대가를 치러야 될 거야.","다음번엔 이것보다 더 잘 해야 될 거야.",
  "그거 돈 낼 필요 없어.","나한테 고마워하지 않아도 돼.","그거 지금 당장 안 해도 돼.","그런 말에 신경 쓸 것 없어.",

  "넌 선택을 해야 돼.","마감일 꼭 맞춰야 해!","네가 꼭 와서 이걸 봐야 해.","넌 이 록 밴드 노래를 들어봐야 돼.",
  "절대로 포기하면 안 돼.","취하면 절대 안 돼.","너무 많이 먹으면 안 돼.","절대로 흥분하면 안 돼.",

  "너무 확신하지 마.","너무 조급해하지 좀 마.","그렇게 고집 좀 부리지 마.","그렇게 비꼬지 좀 마.",
  "너 그 문신을 후회하게 될걸.","그 여자를 떠나보낸 걸 후회하게 될 거야.","시도도 해보지 않는다면 후회할 거야.","지금 그 집을 사지 않으면 후회하게 될 거야.",

  "나한테 거짓말 그만 하라고 했지.","기다리라고 했잖아.","날 성가시게 하지 말라고 했잖아.","설탕 좀 줄이라고 했잖아.",
  "날 방해하지 말라고 했잖아.","음주운전하지 말라고 말했잖아.","내가 말하고 있는데 전화 끊지 말라고 했지.","그걸 먹지 말라고 말했잖아.",

  "나에게서 떨어지라고 경고했잖아.","경찰을 부르겠다고 그 사람한테 경고했어.","아이들에게 독극물에 대해 경고했어.","그거 하지 말라고 경고했잖아.",

  "오늘 너무 피곤해.","기분이 엉망이야.","무척 주눅이 드네.","죄책감이 너무 심하게 들어.",
  "이 프로젝트가 잘 되고 있는 느낌이 드는데.","그 애가 날 싫어하는 것 같은 기분이 들어.","내가 해낼 수 없을 것 같은 느낌이 들어요.","바보가 된 기분이야.",

  "비가 오면 우울해져.","이 소파에 앉으면 정말 편안해.","그 사람이랑 있으면 항상 기분이 좋아져.","너랑 있으면 내가 꼭 네 노예인 것 같아.",

  "낯이 익어 보이는데요.","너 오늘 너무 멋지다.","기운이 좀 없어 보인다.","10년은 젊어 보이는데!",

  "모래밭에서 바늘 찾기 같아.","그건 악몽 같아.","여기서 내가 재판 받는 것 같잖아.","그건 내 인생 최고의 인연인 것 같아.",

  "그 애는 바쁜 것 같아.","네 개가 아픈 것 같은데.","당신은 새 자동차가 필요한 것 같군요.","그 애는 바쁜 것 같아.",

  "좋은 생각인 것 같아.","제리가 널 좋아하는 것 같은데.","네가 그 사람을 화나게 한 것 같아.","지독한 감기에 걸린 것 같구나.",

  "집에서 뭔가 타고 있는 것 같은 냄새가 나는데.","뭔가 썩은 것 같은 냄새가 나는데.","경유 같은 냄새가 나는데.","여기서 양배추 같은 냄새가 나는데.",

  "닭고기 같은 맛이야.","엄마가 만든 것 같은 맛이야.","맛이 상한 것 같아.","맛을 보니 소금을 너무 많이 넣은 것 같아.",

  "꼭 무슨 일이 생길 것만 같아.","비가 올 것 같아.","나 혼자뿐인 것 같아.","싸우는 것 같아."
];

const day11Patterns = [
  "너... 한 것 같구나","너 ...한 것 같아","... 인 것 같아","넌 .. 한 것 같지 않아","그건 ... 한 것 같지 않아",
  "(추측컨대)...인 것 같아","뭐가...하는지 알아?","누가 ...하는지 알아?","분명히.. 일거야","분명히...였을거야",
  "빨리 ...하고 싶어","...를 못참겠어","..를 멈출 수가 없어","...할 형편이 못돼","...도 못하겠어",
  "난 ...를 잘해","난...에는 별로 소질이 없어","너무 ...해서 ...할 수 없어","난 ...할 정도로...하지않아","...할수 있을거야",
  "..하는 건 불가능해","...하는게 가능해?","...하는 게 가능할까요?","...할 가능성이 높아","...할 가능성이 있어?"
];
const day12Patterns = [
  "넌 ...할수도 있어","넌 ...할 수도 있었어","나 ...일지도 몰라","나 ...했을지도 몰라","나...할 수 있을지도 몰라",
  "네가 ....하면 좋겠어","당신이...해주면 해요","네가 ...하지 않았으면 해","내가 ...할까?","내가 뭘...할까?",
  "...하시겠어요?","무슨...를 하고.싶으세요","어디서...하고싶으세요?","언제...하고 싶으세요?","...를 어떻게 해드릴까요?",
  "난 ...가 더좋아","난...하는게 낫겠어","...하는 걸 더 좋아하세요?","...하는 게 낫겠어요?","어떤 것을 ...할래?",
  "...하고 싶어?","...하고 싶지 않아","..하고 싶니?","..하고 싶은 기분이야","...할 기분이 아니야"
];
const day13Patterns = [
  "~는 어때?","네~는 어때?","어떻게 ~하니?","어떻게~했어?","어떻게~할거야?",
  "내가 어떻게~하지","제가 어떻게~할 수 있나요?","너 어떻게 ~할 수 있어?","~는 어떻게 됐어?","~하는 방법을 가르쳐줄게",
  "몇 개나/","몇명이나?","~중 몇 개나/몇 명이나?","얼마나~?","얼마나 자주~?","얼마나 멀리~?",
  "언제쯤~?","얼마나 오래?","~하는데 얼마나 걸리니?","~하는데 ~가 걸려","~하는데 얼마나 있어야 되죠?",
  "~한다고 약속할게","~한다고 약속하는 거야?","너 ~한다고 약속했잖아","~하지 않을게","절대~하지않겠어"
];
const day14Patterns = [
  "~하기로 결정했어","~하지 않기로 결정했어","...는 결정했나요?","왜..하기로 결정한거야?","...하기로 결정했어",
  "...하면좋겠어","네가..하기를 바랄게","...하길바라자","...였으면 좋겠어","...할 수 있다면 좋겠어",
  "한번 ...해봐","...하려고 노력해봐","...하지 않도록 해봐","...하려고 노력중이야","우리...하도록 해보자",
  "...에 질렸어","..하는데 정말 질렸어","...하는게 지긋지긋해","...를 더 이상 못참겠어","내가 몇 번이나 ...해야해?",
  "완전...하네!","넌 왜 만날 ...니?","왜 ...하지 않았어?","...하지도 마","넌...도 모르면서"
];
const day15Patterns = [
  "..했어야 했는데","...하는 게 아니었는데","절대...하지 말았어야 했는데","...하지 말았어야 하는데","...한 걸 후회해",
  "...에 감동받았어","...가 걱정돼","얼마나 ...한지 모르겠어요","너 때문에 내가 ...해","나 ...하게 하지마",
  "이제 ..할 시간이야","..할 시간이 없어","...할때마다","가장 최근에...했을때","...하는 건 이게 마지막이야",
  "아무도...하지않아","아무도...를 안믿을거야","아무도...못해","--말고는 아무도...못해","--보다 더 ...한 사람은 없어",
  "그 무엇도 ..할 수 없어","단지...일 뿐","...와 아무 관련이 없어","--보다 더 ...한 건 없어","무슨 ...를 해도"
];
const day16Patterns = [
  "누구..하는 사람?","..한 사람 있었어?","...인 사람?","... 할 수 있는 사람?","....한 사람 있어?",
  "...한 기억이 나","...기억하니?","잊지 않고...했어?","...하는 거 잊지마","...가 생각이 안나",
  "...를 깜박했어","...하는 걸 깜박했어","...는 그만 잊어버려","나에게 ...하라고 일러줘","A를 보니 ...가 생각나는 군",
  "난 ...하기로 했어","너 ...하면 안 되잖아","원래 ..해야 하는 건데","내가 ...해야 되는 거야?","내가 뭘 ...해야 하지?",
  "네가 ...해야 하는 건데","네가 ...할 줄은 몰랐어","...할 줄은 몰랐어","A가 ...할까?","A가 언제 ...할 것 같아요?"
];
const day17Patterns = [
  "~를 본 적 있어","~를 들었어","...한 적이 없어","...한 적이 한번도 없어","...해본 적 있어?",
  "계속... 해왔어","항상...해왔어","계속...해오고있어","계속...를못해오고있어","넌 계속...하는 구나",
  "계속...했니?","그동안 어디서...했어?","...한 지 얼마나 됐어?","...한지 얼마나 됐지?","...한지 좀 됐지",
  "벌써...했어","이제 막...했어","아직 ...못했어","(이제)...했어?","....는 다 했어?",
  "...하는 건 쉽지 않아","...하는 게 훨씬 쉬워","..하는 건 어려워","...하기가 어려워","...하는게 중요해"
];
const day18Patterns = [
  "...하기가 힘들어","...하기가 힘들어","...에 문제가 있어","...에 문제가 있어","...하기에 너무 늦었어",
  "내가...해야하니?","내가 뭘...해야하지?","내가...해야할까?","내가 뭘...해야 할까?","나 뭘...하지?",
  "...일거야","...할 수 있을거야","그거 ...하겠는데","...안 할거야","...하는게 ...일까요?",
  "만약 ...가 있다면","네가 원하면, 내가 ...할게","내가 너라면","내가..한다면,....할텐데","내가...했다면...했을텐데",
  "...한다면 어떡하지?","...한다고 해도","(비록)...이지만","비록....이지만","마치...인것처럼"
];
const day19Patterns = [
  "...하면 바로","...하기만 하면","...할 때쯤에는","...할지도 모르니깐","이제...하니깐",
  "...하는게 뭐든","...할때마다","어디서...하든","누가...한지 몰라도","아무리...해도",
  "..가...하게하다","...이 ...되게 하다","...이...되도록 만들다","...하게 해줄게","...가...하게 하지 않을 거야",
  "점점...해지다","...를 잘 알고 있니?","..에 익숙하지 않아","..에 점점 익숙해지고 있어","...하곤 했지",
  "..가 있어","...가 있어?","...봤어?","너 ...했다며","...하니까 딱 알겠던데"
];
const day20Patterns = [
  "너..해선 안 될 것 같아","...는 미처 몰랐어","난 결국 ...하고 말았어","이런 걸","그런 건",
  "....를 말해줄게","...설명해줄게","중요한 건...라는 거야","내 말은...라는 거야","..라고 치자",
  "...인 것 같아","미안하지만","...하기는 싫지만,...","...인 것 같아","혹시 네가 ...하지 않을까 해서",
  "...하는게 좋겠어","분명히..해","...를 알 수가 없어","왜...한지 모르겠어","...를 따를게",
  "그렇게 ..한건 처음이었어","가장/아주..해","정말...해","정말...하고 싶지 않아","가장먼저하는것은"
];

function makeDay(dayNum, patterns){
  return { day: dayNum, patterns: patterns.map((ko, i)=>({ id:`D${dayNum}P${i+1}`, ko, examples:[] })) };
}
function baseDays(){
  const days = [];
  days.push(buildDay1WithOfficialExamples());
  days.push(makeDay(2, day2Patterns));
  days.push(makeDay(3, day3Patterns));
  days.push(makeDay(4, day4Patterns));
  days.push(makeDay(5, day5Patterns));
  days.push(makeDay(6, day6Patterns));
  days.push(makeDay(7, day7Patterns));
  days.push(makeDay(8, day8Patterns));
  days.push(makeDay(9, day9Patterns));
  days.push(makeDay(10, day10Patterns));
  days.push(makeDay(11, day11Patterns));
  days.push(makeDay(12, day12Patterns));
  days.push(makeDay(13, day13Patterns));
  days.push(makeDay(14, day14Patterns));
  days.push(makeDay(15, day15Patterns));
  days.push(makeDay(16, day16Patterns));
  days.push(makeDay(17, day17Patterns));
  days.push(makeDay(18, day18Patterns));
  days.push(makeDay(19, day19Patterns));
  days.push(makeDay(20, day20Patterns));
  return days;
}

/* =========================
   Load / Merge + Legacy Migration
========================= */
function normalizeDay(dayObj, baseDay){
  const day = Number(dayObj.day);
  const patterns = Array.isArray(dayObj.patterns) ? dayObj.patterns : (baseDay?.patterns || []);
  const normPatterns = patterns.map((p, idx)=>{
    const id = p?.id || (baseDay?.patterns?.[idx]?.id) || uid(`D${day}P`);
    const ko = safeTrim(p?.ko ?? baseDay?.patterns?.[idx]?.ko ?? "");
    const examples = Array.isArray(p?.examples) ? p.examples : (baseDay?.patterns?.[idx]?.examples || []);
    const normExamples = examples.map(ex=>({
      id: ex?.id || uid("ex"),
      ko: safeTrim(ex?.ko ?? ""),
      en: safeTrim(ex?.en ?? ""),
      source: ex?.source === "official" ? "official" : "user"
    }));
    return { id, ko, examples: normExamples };
  }).filter(p => p.ko.length>0);
  return { day, patterns: normPatterns };
}

/* ✅ 레거시 저장키를 찾아서 가장 그럴듯한 데이터를 선택 */
function findBestStoredDaysFromAnyKey(){
  const candidates = [];
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(!k) continue;
    if(!/patternquizapp/i.test(k)) continue;
    if(!/days/i.test(k)) continue;

    try{
      const raw = localStorage.getItem(k);
      const parsed = JSON.parse(raw || "null");
      if(!Array.isArray(parsed)) continue;

      const days = parsed.filter(d => d && typeof d.day === "number" && d.day >= 1 && Array.isArray(d.patterns));
      if(days.length === 0) continue;

      const maxDay = Math.max(...days.map(d=>d.day));
      const totalPatterns = days.reduce((sum,d)=>sum+(d.patterns?.length||0),0);
      // 점수: day 수 + maxDay + 패턴 수
      const score = days.length*10000 + maxDay*100 + totalPatterns;

      candidates.push({ key:k, data:days, score });
    }catch(e){
      // ignore
    }
  }

  // STORE_KEY가 없으면, 예전 키 중 가장 score 높은 걸 사용
  candidates.sort((a,b)=>b.score-a.score);
  return candidates[0] || null;
}

function loadDays(){
  const base = baseDays();

  // 1) 현재 STORE_KEY가 있으면 우선 사용
  let saved = null;
  try{
    saved = JSON.parse(localStorage.getItem(STORE_KEY) || "null");
  }catch(e){ saved = null; }

  // 2) STORE_KEY가 없거나 이상하면, 레거시 키들에서 찾아서 마이그레이션
  if(!saved || !Array.isArray(saved) || saved.length===0){
    const best = findBestStoredDaysFromAnyKey();
    if(best && Array.isArray(best.data)){
      saved = best.data;
      // 마이그레이션(복사): 앞으로 STORE_KEY로 저장
      localStorage.setItem(STORE_KEY, JSON.stringify(saved));
    }else{
      // 아무것도 없으면 base로 초기화
      localStorage.setItem(STORE_KEY, JSON.stringify(base));
      return base;
    }
  }

  // savedByDay
  const savedByDay = new Map();
  for(const d of saved){
    if(!d || typeof d.day !== "number") continue;
    if(d.day <= 0) continue; // ✅ day0 차단
    savedByDay.set(d.day, d);
  }

  // base day(1~20) + saved merge
  const merged = [];
  for(const b of base){
    const s = savedByDay.get(b.day);
    if(s){
      merged.push(normalizeDay(s, b));
      savedByDay.delete(b.day);
    }else{
      merged.push(normalizeDay(b, b));
    }
  }

  // extra days (>=21)
  const extraDays = Array.from(savedByDay.values())
    .filter(d => typeof d.day === "number" && d.day >= 21)
    .map(d => normalizeDay(d, null))
    .sort((a,b)=>a.day-b.day);

  merged.push(...extraDays);

  // 최종 저장 (day0 제거 포함)
  const finalDays = merged.filter(d => d.day >= 1);
  localStorage.setItem(STORE_KEY, JSON.stringify(finalDays));
  return finalDays;
}

function saveDays(){ localStorage.setItem(STORE_KEY, JSON.stringify(state.days)); }

function loadUI(){
  try{ return JSON.parse(localStorage.getItem(STORE_UI) || "null") || {}; }
  catch(e){ return {}; }
}
function saveUI(){ localStorage.setItem(STORE_UI, JSON.stringify(state.ui)); }

/* =========================
   Review (예문 단위 복습)
========================= */
function loadReview(){
  try{
    const raw = localStorage.getItem(REVIEW_KEY());
    const arr = JSON.parse(raw || "[]");
    return Array.isArray(arr) ? arr : [];
  }catch(e){
    return [];
  }
}
function saveReview(){
  localStorage.setItem(REVIEW_KEY(), JSON.stringify(state.review.items));
  updateReviewBadge();
}
function updateReviewBadge(){
  const n = state.review.items.length;
  const b = $("#reviewBadge");
  if(b){
    b.textContent = String(n);
    b.classList.toggle("on", n>0);
  }
}
function isInReview(patternId, exId){
  return state.review.items.some(it => it.patternId===patternId && it.exId===exId);
}
function addToReview(foundDay, pattern, ex){
  if(!pattern || !ex) return;
  const patternId = pattern.id;
  const exId = ex.id;
  if(!patternId || !exId) return;

  if(isInReview(patternId, exId)){
    $("#exStatus").textContent = "이미 복습 리스트에 있어요.";
    return;
  }

  state.review.items.push({
    id: uid("rv"),
    date: todayKey(),
    day: foundDay,
    patternId,
    patternKo: pattern.ko || "",
    exId,
    exKo: ex.ko || "",
    exEn: ex.en || "",
    addedAt: Date.now()
  });
  saveReview();
  $("#exStatus").textContent = "복습 리스트에 추가했어요.";
  renderExamples(pattern);
}
function removeFromReview(reviewId){
  state.review.items = state.review.items.filter(it => it.id !== reviewId);
  saveReview();
}
function clearReview(){
  state.review.items = [];
  saveReview();
}

/* =========================
   App State
========================= */
const state = {
  days: [],
  ui: { selectedDays: [], quizCount: "전체" },
  quiz: { items: [], idx: 0, showAnswer: false, current: null },
  review: { items: [] },
  import: { parsed: null }
};

function getDayObj(dayNum){ return state.days.find(d=>d.day===dayNum) || null; }
function findPatternById(pid){
  for(const d of state.days){
    const p = d.patterns.find(x=>x.id===pid);
    if(p) return { day:d.day, pattern:p };
  }
  return null;
}

/* =========================
   Render Home
========================= */
function renderDayButtons(){
  const grid = $("#dayGrid");
  grid.innerHTML = "";

  const days = state.days
    .filter(d => d.day >= 1 && Array.isArray(d.patterns) && d.patterns.length>0)
    .sort((a,b)=>a.day-b.day);

  const selected = new Set(state.ui.selectedDays);

  days.forEach(d=>{
    const btn = document.createElement("div");
    btn.className = "chip" + (selected.has(d.day) ? " selected" : "");
    btn.dataset.day = String(d.day);

    const count = d.patterns.length;
    btn.innerHTML = `DAY ${d.day}<span class="mini">${count}개</span>`;
    btn.addEventListener("click", ()=>{
      const dayNum = Number(btn.dataset.day);
      if(selected.has(dayNum)) selected.delete(dayNum);
      else selected.add(dayNum);

      state.ui.selectedDays = Array.from(selected).sort((a,b)=>a-b);
      saveUI();
      renderDayButtons();
      updateStartEnabled();
    });
    grid.appendChild(btn);
  });
}
function renderCountButtons(){
  const grid = $("#countGrid");
  grid.innerHTML = "";
  const opts = ["전체","10개","20개","30개","40개","50개","60개","70개","80개","90개","100개"];
  opts.forEach(opt=>{
    const btn = document.createElement("div");
    btn.className = "chip" + (state.ui.quizCount===opt ? " selected" : "");
    btn.textContent = opt;
    btn.addEventListener("click", ()=>{
      state.ui.quizCount = opt;
      saveUI();
      renderCountButtons();
    });
    grid.appendChild(btn);
  });
}
function updateStartEnabled(){
  const start = $("#btnStart");
  const ok = state.ui.selectedDays.length > 0;
  start.disabled = !ok;
  $("#homeStatus").textContent = ok ? "" : "DAY를 1개 이상 선택해야 시작할 수 있어요.";
}

/* =========================
   Add Pattern (DAY21+)
========================= */
function getAutoDayForNewPattern(){
  let day = 21;
  while(true){
    let d = getDayObj(day);
    if(!d){
      d = { day, patterns: [] };
      state.days.push(d);
      state.days.sort((a,b)=>a.day-b.day);
      return day;
    }
    if((d.patterns?.length || 0) < 25) return day;
    day++;
  }
}
function addNewPattern(){
  const ko = safeTrim($("#inpNewPattern").value);
  if(!ko){
    $("#addPatternStatus").textContent = "패턴 한글 의미를 입력해줘.";
    return;
  }

  let dayInput = safeTrim($("#inpNewDay").value);
  let dayNum = dayInput ? Number(dayInput) : getAutoDayForNewPattern();
  if(!Number.isFinite(dayNum) || dayNum < 21) dayNum = getAutoDayForNewPattern();

  while(true){
    let d = getDayObj(dayNum);
    if(!d){
      d = { day: dayNum, patterns: [] };
      state.days.push(d);
      state.days.sort((a,b)=>a.day-b.day);
    }
    if(d.patterns.length < 25) break;
    dayNum++;
  }

  const d = getDayObj(dayNum);
  d.patterns.push({ id: uid(`D${dayNum}P`), ko, examples: [] });

  saveDays();
  $("#inpNewPattern").value = "";
  $("#inpNewDay").value = "";
  $("#addPatternStatus").textContent = `추가 완료: DAY ${dayNum} (총 ${d.patterns.length}개)`;

  renderDayButtons();
  updateStartEnabled();
}

/* =========================
   Quiz Build / Start
========================= */
function buildQuizItems(){
  const selectedDays = state.ui.selectedDays.slice().sort((a,b)=>a-b);
  const pool = [];
  for(const dayNum of selectedDays){
    const d = getDayObj(dayNum);
    if(!d) continue;
    for(const p of d.patterns){
      pool.push({ day: dayNum, patternId: p.id });
    }
  }

  const shuffled = shuffle(pool);
  let items = shuffled;

  if(state.ui.quizCount !== "전체"){
    const n = Number(state.ui.quizCount.replace("개",""));
    if(Number.isFinite(n) && n > 0){
      items = shuffled.slice(0, Math.min(n, shuffled.length));
    }
  }
  return items;
}
function startQuiz(){
  $("#homeStatus").textContent = "";
  if(state.ui.selectedDays.length === 0){
    $("#homeStatus").textContent = "DAY를 1개 이상 선택해야 시작할 수 있어요.";
    updateStartEnabled();
    return;
  }
  const items = buildQuizItems();
  if(items.length === 0){
    $("#homeStatus").textContent = "선택한 DAY에 패턴이 없어요.";
    return;
  }

  state.quiz.items = items;
  state.quiz.idx = 0;
  state.quiz.showAnswer = false;
  state.quiz.current = null;

  switchScreen("screenQuiz");
  renderQuiz();
}

/* =========================
   Quiz Render / Actions
========================= */
function renderQuiz(){
  updateReviewBadge();

  const idx = state.quiz.idx;
  const total = state.quiz.items.length;

  $("#progressText").textContent = `진행: ${idx+1} / ${total}`;
  $("#quizStatus").textContent = "";
  $("#exStatus").textContent = "";
  $("#inpExKo").value = "";
  $("#inpExEn").value = "";

  const item = state.quiz.items[idx];
  if(!item){ finishQuiz(); return; }

  const found = findPatternById(item.patternId);
  if(!found){
    state.quiz.idx++;
    renderQuiz();
    return;
  }

  state.quiz.current = found;
  $("#dayInfo").textContent = `DAY ${found.day}`;
  $("#questionText").textContent = found.pattern.ko;

  state.quiz.showAnswer = false;
  $("#answerBox").classList.remove("show");
  $("#btnShowAnswer").disabled = false;

  renderExamples(found.pattern);
}
function renderExamples(pattern){
  const list = $("#exampleList");
  list.innerHTML = "";

  const ex = Array.isArray(pattern.examples) ? pattern.examples : [];
  const found = findPatternById(pattern.id);
  const dayNum = found?.day ?? null;

  if(ex.length === 0){
    const empty = document.createElement("div");
    empty.className = "exItem";
    empty.innerHTML = `<div class="exKo">예문이 아직 없어요.</div><div class="exEn">아래에서 예문(한글/영어)을 추가해줘.</div>`;
    list.appendChild(empty);
    return;
  }

  ex.forEach((e, i)=>{
    const item = document.createElement("div");
    item.className = "exItem";
    const ko = e.ko || "(한글 없음)";
    const en = e.en || "(영어 없음)";
    const inReview = isInReview(pattern.id, e.id);

    item.innerHTML = `
      <div class="exKo">${i+1}. ${escapeHtml(ko)}</div>
      <div class="exEn">${escapeHtml(en)}</div>
      <div class="exActions">
        <button class="btn btn-small ${inReview ? "btn-primary" : "btn-ghost"}" data-act="review" data-exid="${e.id}">${inReview ? "L✓" : "L"}</button>
        <button class="btn btn-small btn-ghost" data-act="del" data-exid="${e.id}">이 예문 삭제</button>
      </div>
    `;

    const btnReview = item.querySelector('button[data-act="review"]');
    const btnDel = item.querySelector('button[data-act="del"]');
    attachPressGlow(btnReview);
    attachPressGlow(btnDel);

    btnReview.addEventListener("click", ()=> addToReview(dayNum, pattern, e));
    btnDel.addEventListener("click", ()=> deleteOneExample(pattern.id, e.id));

    list.appendChild(item);
  });
}
function showAnswer(){
  state.quiz.showAnswer = true;
  $("#answerBox").classList.add("show");
  $("#btnShowAnswer").disabled = true;
}
function nextQuestion(){
  state.quiz.idx++;
  renderQuiz();
}
function addExampleToCurrent(){
  const cur = state.quiz.current;
  if(!cur) return;

  const ko = safeTrim($("#inpExKo").value);
  const en = safeTrim($("#inpExEn").value);
  if(!ko && !en){
    $("#exStatus").textContent = "한글/영어 중 하나라도 입력해줘.";
    return;
  }

  const found = findPatternById(cur.pattern.id);
  if(!found) return;

  found.pattern.examples.push({ id: uid("ex"), ko, en, source:"user" });
  saveDays();

  $("#inpExKo").value = "";
  $("#inpExEn").value = "";
  $("#exStatus").textContent = "예문 추가 완료";
  renderExamples(found.pattern);
}
function deleteOneExample(patternId, exId){
  const found = findPatternById(patternId);
  if(!found) return;

  found.pattern.examples = (found.pattern.examples || []).filter(e => e.id !== exId);
  saveDays();
  $("#exStatus").textContent = "삭제 완료";
  renderExamples(found.pattern);
}
function deleteAllExamplesOfCurrent(){
  const cur = state.quiz.current;
  if(!cur) return;
  const found = findPatternById(cur.pattern.id);
  if(!found) return;

  found.pattern.examples = [];
  saveDays();
  $("#exStatus").textContent = "모든 예문 삭제 완료";
  renderExamples(found.pattern);
}

/* =========================
   Results (오늘 복습 리스트)
========================= */
function renderReviewCards(items){
  const wrap = $("#wrongListWrap");
  wrap.innerHTML = "";

  if(items.length === 0){
    const div = document.createElement("div");
    div.className = "wrongCard";
    div.innerHTML = `<div class="wk">오늘 복습에 추가한 예문이 아직 없어요. (퀴즈에서 예문 오른쪽 L 버튼 눌러줘!)</div>`;
    wrap.appendChild(div);
    return;
  }

  const sorted = items.slice().sort((a,b)=>b.addedAt-a.addedAt);

  sorted.forEach((it, idx)=>{
    const card = document.createElement("div");
    card.className = "wrongCard";
    card.innerHTML = `
      <div class="wk">
        ${idx+1}. ${escapeHtml(it.patternKo)}
        <span class="dayTag">DAY ${it.day}</span>
      </div>
      <div class="exList">
        <div class="exItem">
          <div class="exKo">한글: ${escapeHtml(it.exKo || "(한글 없음)")}</div>
          <div class="exEn">영어: ${escapeHtml(it.exEn || "(영어 없음)")}</div>
          <div class="exActions">
            <button class="btn btn-small btn-ghost" data-act="removeReview" data-rvid="${it.id}">복습에서 삭제</button>
          </div>
        </div>
      </div>
    `;
    const btn = card.querySelector('button[data-act="removeReview"]');
    attachPressGlow(btn);
    btn.addEventListener("click", ()=>{
      removeFromReview(it.id);
      renderReviewCards(state.review.items);
      updateResultSummary();
    });
    wrap.appendChild(card);
  });
}
function updateResultSummary(){
  const total = state.quiz.items.length;
  const reviewCount = state.review.items.length;
  $("#resultBig").textContent = `총 ${total}개 진행 · (예문) 오늘 복습 ${reviewCount}개`;
  $("#resultSmall").textContent = "이 화면에는 ‘예문 오른쪽 L 버튼으로 추가한 것만’ 모여요. (공식/내 예문 모두 가능)";
}
function finishQuiz(){
  $("#copyStatus").textContent = "";
  updateResultSummary();
  renderReviewCards(state.review.items);
  switchScreen("screenResult");
}
async function copyReview(){
  const items = state.review.items.slice().sort((a,b)=>a.addedAt-b.addedAt);
  if(items.length === 0){
    $("#copyStatus").textContent = "복사할 복습 문장이 없어요. (퀴즈에서 L 버튼 누르면 추가돼요)";
    return;
  }
  let koBlock = `[오늘 복습 - 한글]\n`;
  let enBlock = `\n[오늘 복습 - 영어]\n`;
  items.forEach((it, idx)=>{
    const n = idx+1;
    koBlock += `${n}. (DAY ${it.day}) ${it.patternKo}\n   - ${it.exKo || ""}\n\n`;
    enBlock += `${n}. (DAY ${it.day}) ${it.patternKo}\n   - ${it.exEn || ""}\n\n`;
  });
  const ok = await copyText(koBlock + enBlock);
  $("#copyStatus").textContent = ok ? "복사 완료 (알림창 없이 조용히 복사됐어)." : "복사 실패 (브라우저 권한 확인)";
}

/* =========================
   Manage / Import
========================= */
function renderManage(){
  const dump = state.days
    .filter(d=>d.day>=1)
    .sort((a,b)=>a.day-b.day)
    .map(d=>{
      return `DAY ${d.day} (${d.patterns.length}개)\n` + d.patterns.map((p,i)=>{
        return `  ${i+1}. ${p.ko}  [예문:${(p.examples||[]).length}]`;
      }).join("\n");
    }).join("\n\n");
  $("#manageDump").textContent = dump || "(데이터 없음)";
}
function renderImportDaySelect(){
  const sel = $("#selImportDay");
  sel.innerHTML = "";
  const days = state.days
    .filter(d => d.day >= 2 && d.day <= 20)
    .sort((a,b)=>a.day-b.day);

  days.forEach(d=>{
    const opt = document.createElement("option");
    opt.value = String(d.day);
    opt.textContent = `DAY ${d.day}`;
    sel.appendChild(opt);
  });
}
function clearExamplesForDay(dayNum){
  const d = getDayObj(dayNum);
  if(!d) return 0;
  let cnt = 0;
  d.patterns.forEach(p=>{
    cnt += (p.examples||[]).length;
    p.examples = [];
  });
  saveDays();
  return cnt;
}
function parseImportText(raw, dayNum){
  const text = (raw || "").replace(/\r/g, "");
  const lines = text.split("\n").map(l=>l.trim()).filter(l=>l.length>0);

  const d = getDayObj(dayNum);
  if(!d) return { ok:false, error:`DAY ${dayNum} 데이터가 없어.` };

  const patternMap = new Map();
  d.patterns.forEach(p=>patternMap.set(p.ko, p));

  const items = [];
  let i = 0;
  while(i < lines.length){
    const pat = lines[i++];
    if(!pat) break;

    const block = [];
    for(let k=0;k<8;k++){
      if(i >= lines.length) break;
      block.push(lines[i++]);
    }
    if(block.length < 8){
      return { ok:false, error:`패턴 "${pat}" 아래 예문 줄이 부족해. (한글/영어 4쌍=8줄 필요)` };
    }
    const exPairs = [];
    for(let t=0;t<4;t++){
      exPairs.push({ ko: block[t*2], en: block[t*2+1] });
    }
    items.push({ pat, exPairs });
  }

  const missing = items.filter(it=>!patternMap.has(it.pat)).map(it=>it.pat);
  return { ok:true, items, missing };
}
function previewImport(){
  const dayNum = Number($("#selImportDay").value);
  const raw = $("#txtImport").value;

  const parsed = parseImportText(raw, dayNum);
  if(!parsed.ok){
    state.import.parsed = null;
    $("#importStatus").textContent = parsed.error;
    $("#importPreview").textContent = "(미리보기 실패)";
    return;
  }

  state.import.parsed = { dayNum, ...parsed };

  const lines = [];
  lines.push(`DAY ${dayNum} 미리보기`);
  lines.push(`- 입력 패턴 수: ${parsed.items.length}`);
  if(parsed.missing.length){
    lines.push(`- ⚠️ DAY${dayNum}에 없는 패턴(매칭 실패): ${parsed.missing.length}개`);
    parsed.missing.slice(0,20).forEach(p=>lines.push(`  - ${p}`));
    if(parsed.missing.length>20) lines.push(`  ... +${parsed.missing.length-20}개 더`);
  }else{
    lines.push(`- 매칭 실패 없음 ✅`);
  }
  lines.push("");
  parsed.items.slice(0,6).forEach((it, idx)=>{
    lines.push(`${idx+1}. ${it.pat}`);
    it.exPairs.forEach((ex, j)=>{
      lines.push(`   - ${j+1}) KO: ${ex.ko}`);
      lines.push(`        EN: ${ex.en}`);
    });
    lines.push("");
  });
  if(parsed.items.length>6) lines.push(`(나머지 ${parsed.items.length-6}개는 생략)`);

  $("#importStatus").textContent = "미리보기 완료. (아래 확인 후 적용하세요)";
  $("#importPreview").textContent = lines.join("\n");
}
function applyImport(){
  const p = state.import.parsed;
  if(!p || !p.ok){
    $("#importStatus").textContent = "먼저 ‘미리보기’를 눌러서 파싱을 완료해줘.";
    return;
  }
  const dayNum = p.dayNum;
  const d = getDayObj(dayNum);
  if(!d){
    $("#importStatus").textContent = `DAY ${dayNum} 데이터가 없어.`;
    return;
  }

  const patternMap = new Map();
  d.patterns.forEach(pt=>patternMap.set(pt.ko, pt));

  let applied = 0, skipped = 0;
  p.items.forEach(it=>{
    const pt = patternMap.get(it.pat);
    if(!pt){ skipped++; return; }
    pt.examples = it.exPairs.map(pair=>({
      id: uid("ex"), ko: pair.ko, en: pair.en, source: "official"
    }));
    applied++;
  });

  saveDays();
  $("#importStatus").textContent = `적용 완료 ✅ (반영: ${applied}개 / 스킵: ${skipped}개)`;
  renderManage();
  renderDayButtons();
}

/* =========================
   Screen Switch
========================= */
function switchScreen(id){
  $$(".screen").forEach(s=>s.classList.remove("active"));
  $("#"+id).classList.add("active");
}

/* =========================
   Init / Wiring
========================= */
function init(){
  $("#todayPill").textContent = `오늘: ${todayKey()}`;

  state.days = loadDays();
  state.ui = { ...state.ui, ...loadUI() };
  state.review.items = loadReview();

  // ✅ day0 방지
  state.days = state.days.filter(d => d.day >= 1);

  if(!state.ui.quizCount) state.ui.quizCount = "전체";
  if(!Array.isArray(state.ui.selectedDays)) state.ui.selectedDays = [];

  // 선택된 day가 이제 존재하지 않으면 정리
  const existingDays = new Set(state.days.map(d=>d.day));
  state.ui.selectedDays = state.ui.selectedDays.filter(d=>existingDays.has(d));

  renderDayButtons();
  renderCountButtons();
  updateStartEnabled();
  updateReviewBadge();

  // Home
  attachPressGlow($("#btnStart"));
  $("#btnStart").addEventListener("click", startQuiz);

  attachPressGlow($("#btnSelectAll"));
  $("#btnSelectAll").addEventListener("click", ()=>{
    const allDays = state.days
      .filter(d=>d.day>=1 && d.patterns.length>0)
      .map(d=>d.day).sort((a,b)=>a-b);
    const allSelected = allDays.length && allDays.every(x=>state.ui.selectedDays.includes(x));
    state.ui.selectedDays = allSelected ? [] : allDays;
    saveUI();
    renderDayButtons();
    updateStartEnabled();
  });

  attachPressGlow($("#btnAddPattern"));
  $("#btnAddPattern").addEventListener("click", addNewPattern);

  // Quiz
  ["btnBackHome","btnShowAnswer","btnNext","btnAddExample","btnDeleteAllExamples"]
    .forEach(id=>attachPressGlow($("#"+id)));

  $("#btnBackHome").addEventListener("click", ()=>{
    switchScreen("screenHome");
    renderDayButtons();
    updateStartEnabled();
  });
  $("#btnShowAnswer").addEventListener("click", showAnswer);
  $("#btnNext").addEventListener("click", nextQuestion);
  $("#btnAddExample").addEventListener("click", addExampleToCurrent);
  $("#btnDeleteAllExamples").addEventListener("click", deleteAllExamplesOfCurrent);

  // Results
  ["btnRestart","btnCopyWrong","btnClearReview"].forEach(id=>attachPressGlow($("#"+id)));
  $("#btnRestart").addEventListener("click", ()=>{
    switchScreen("screenHome");
    renderDayButtons();
    renderCountButtons();
    updateStartEnabled();
  });
  $("#btnCopyWrong").addEventListener("click", copyReview);
  $("#btnClearReview").addEventListener("click", ()=>{
    clearReview();
    $("#copyStatus").textContent = "오늘 복습 리스트를 초기화했어요.";
    updateResultSummary();
    renderReviewCards(state.review.items);
  });

  // Manage
  ["btnGoManage","btnManageBack","btnGoImport"].forEach(id=>attachPressGlow($("#"+id)));
  $("#btnGoManage").addEventListener("click", ()=>{
    renderManage();
    switchScreen("screenManage");
  });
  $("#btnManageBack").addEventListener("click", ()=>{
    switchScreen("screenHome");
    renderDayButtons();
    updateStartEnabled();
  });
  $("#btnGoImport").addEventListener("click", ()=>{
    renderImportDaySelect();
    $("#txtImport").value = "";
    $("#importPreview").textContent = "(미리보기 버튼을 누르면 여기에 보여)";
    $("#importStatus").textContent = "";
    state.import.parsed = null;
    switchScreen("screenImport");
  });

  // Import
  ["btnImportBack","btnImportPreview","btnImportApply","btnImportClearDay"].forEach(id=>attachPressGlow($("#"+id)));
  $("#btnImportBack").addEventListener("click", ()=>{
    renderManage();
    switchScreen("screenManage");
  });
  $("#btnImportPreview").addEventListener("click", previewImport);
  $("#btnImportApply").addEventListener("click", applyImport);
  $("#btnImportClearDay").addEventListener("click", ()=>{
    const dayNum = Number($("#selImportDay").value);
    const cnt = clearExamplesForDay(dayNum);
    $("#importStatus").textContent = `DAY ${dayNum} 예문 전체 삭제 완료 (삭제된 예문: ${cnt}개)`;
    $("#importPreview").textContent = "(미리보기 버튼을 누르면 여기에 보여)";
    state.import.parsed = null;
  });

  updateStartEnabled();
}

init();
</script>
</body>
</html>
